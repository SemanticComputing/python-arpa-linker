<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>arpa API documentation</title>
    <meta name="description" content="A module for linking resources to an RDF graph with an [ARPA](https://github.com/jiemakel/arpa) serv..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>


  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#arpa.LABEL_PROP">LABEL_PROP</a></li>
    <li class="mono"><a href="#arpa.TYPE_PROP">TYPE_PROP</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#arpa.arpafy">arpafy</a></li>
    <li class="mono"><a href="#arpa.main">main</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#arpa.Arpa">Arpa</a></span>
        
          
  <ul>
    <li class="mono"><a href="#arpa.Arpa.__init__">__init__</a></li>
    <li class="mono"><a href="#arpa.Arpa.get_uri_matches">get_uri_matches</a></li>
    <li class="mono"><a href="#arpa.Arpa.query">query</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">arpa</span> module</h1>
  <p>A module for linking resources to an RDF graph with an <a href="https://github.com/jiemakel/arpa">ARPA</a> service</p>
<h2>Requirements</h2>
<p>Python 3, <a href="http://rdflib.readthedocs.org/en/latest/">RDFLib</a> and <a href="http://docs.python-requests.org/en/latest/">Requests</a></p>
<p>If you want to see a progress bar, you'll need <a href="https://github.com/rasbt/pyprind">PyPrind</a>.</p>
<h2>Usage</h2>
<p>The module can be invoked as a script from the command line or by calling <a href="#arpa.arpafy"><code>arpafy</code></a> in your Python code.</p>
<pre><code>usage: arpa.py [-h] [--fi INPUT_FORMAT] [--fo OUTPUT_FORMAT]
            [--rdf_class CLASS] [--prop PROPERTY]
            [--ignore [TERM [TERM ...]]] [--min_ngram N]
            [--no_duplicates [TYPE [TYPE ...]]]
            input output target_property arpa

Link resources to an RDF graph with ARPA.

positional arguments:
input                 Input rdf file
output                Output file
target_property       Target property for the matches
arpa                  ARPA service URL

optional arguments:
-h, --help            show this help message and exit
--fi INPUT_FORMAT     Input file format (rdflib parser). Will be guessed if
                      omitted.
--fo OUTPUT_FORMAT    Output file format (rdflib serializer). Default is
                      turtle.
--rdf_class CLASS     Process only subjects of the given type (goes through
                      all subjects by default).
--prop PROPERTY       Property that's value is to be used in matching.
                      Default is skos:prefLabel.
--ignore [TERM [TERM ...]]
                    Terms that should be ignored even if matched
--min_ngram N         The minimum ngram length that is considered a match.
                      Default is 1.
--no_duplicates [TYPE [TYPE ...]]
                    Remove duplicate matches based on the 'label' returned
                    by the ARPA service. Here 'duplicate' means a subject
                    with the same label as another subject in the same
                    result set. A list of types can be given with this
                    argument. If given, prioritize matches based on it -
                    the first given type will get the highest priority and
                    so on. Note that the response from the service has to
                    include a 'type' variable for this to work.
</code></pre>
<p>The arguments can also be read from a file using "@" (example arg file <a href="https://github.com/SemanticComputing/python-arpa-linker/blob/master/arpa.args">arpa.args</a>):</p>
<p><code>$ python3 arpa.py @arpa.args</code></p>
<h2>Examples</h2>
<p>See <a href="https://github.com/SemanticComputing/python-arpa-linker/blob/master/menehtyneet.py">menehtyneet.py</a>
for a code example and <a href="https://github.com/SemanticComputing/python-arpa-linker/blob/master/arpa.args">arpa.args</a>
for an example arg file.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-arpa', this);">Show source &equiv;</a></p>
  <div id="source-arpa" class="source">
    <pre><code>"""
A module for linking resources to an RDF graph with an [ARPA](https://github.com/jiemakel/arpa) service

## Requirements
Python 3, [RDFLib](http://rdflib.readthedocs.org/en/latest/) and [Requests](http://docs.python-requests.org/en/latest/)

If you want to see a progress bar, you'll need [PyPrind](https://github.com/rasbt/pyprind).

## Usage

The module can be invoked as a script from the command line or by calling `arpa.arpafy` in your Python code.

    usage: arpa.py [-h] [--fi INPUT_FORMAT] [--fo OUTPUT_FORMAT]
                [--rdf_class CLASS] [--prop PROPERTY]
                [--ignore [TERM [TERM ...]]] [--min_ngram N]
                [--no_duplicates [TYPE [TYPE ...]]]
                input output target_property arpa

    Link resources to an RDF graph with ARPA.

    positional arguments:
    input                 Input rdf file
    output                Output file
    target_property       Target property for the matches
    arpa                  ARPA service URL

    optional arguments:
    -h, --help            show this help message and exit
    --fi INPUT_FORMAT     Input file format (rdflib parser). Will be guessed if
                          omitted.
    --fo OUTPUT_FORMAT    Output file format (rdflib serializer). Default is
                          turtle.
    --rdf_class CLASS     Process only subjects of the given type (goes through
                          all subjects by default).
    --prop PROPERTY       Property that's value is to be used in matching.
                          Default is skos:prefLabel.
    --ignore [TERM [TERM ...]]
                        Terms that should be ignored even if matched
    --min_ngram N         The minimum ngram length that is considered a match.
                          Default is 1.
    --no_duplicates [TYPE [TYPE ...]]
                        Remove duplicate matches based on the 'label' returned
                        by the ARPA service. Here 'duplicate' means a subject
                        with the same label as another subject in the same
                        result set. A list of types can be given with this
                        argument. If given, prioritize matches based on it -
                        the first given type will get the highest priority and
                        so on. Note that the response from the service has to
                        include a 'type' variable for this to work.

The arguments can also be read from a file using "@" (example arg file [arpa.args](https://github.com/SemanticComputing/python-arpa-linker/blob/master/arpa.args)):

`$ python3 arpa.py @arpa.args`

## Examples

See [menehtyneet.py](https://github.com/SemanticComputing/python-arpa-linker/blob/master/menehtyneet.py)
for a code example and [arpa.args](https://github.com/SemanticComputing/python-arpa-linker/blob/master/arpa.args)
for an example arg file.
"""

import argparse
import requests
import time
from datetime import timedelta
from requests.exceptions import HTTPError
from rdflib import Graph, URIRef
from rdflib.namespace import RDF, SKOS
from rdflib.util import guess_format

__all__ = ['Arpa', 'arpafy', 'main', 'LABEL_PROP', 'TYPE_PROP']

LABEL_PROP = 'label'
"""The name of the property containing the label of the match in the ARPA results."""

TYPE_PROP = 'type'
"""
The name of the property containing the type of the match in the ARPA results->properties.
Only needed for prioritized duplicate removal.
"""

class Arpa:
    """Class representing the ARPA service"""

    def __init__(self, url, remove_duplicates=False, min_ngram_length=1, ignore=None):
        """
        Initialize the Arpa service object.

        `url` is the ARPA service url.

        If `remove_duplicates` is `True`, choose only one subject out of all the
        matched subjects that have the same label (arbitrarily).
        If, instead, the value is a list or a tuple, assume that it represents
        a list of class names and prefer those classes when choosing
        the subject. The ARPA results must include a property (`TYPE_PROP`)
        that has the class of the match as the value.

        `min_ngram_length` is the minimum ngram match length that will be included when
        returning the query results.

        `ignore` is a list of matches that should be removed from the results (case insensitive).
        """

        self._url = url
        self._ignore = [s.lower() for s in ignore or []]
        self._min_ngram_length = min_ngram_length

        if type(remove_duplicates) == bool:
            self._no_duplicates = remove_duplicates
        else:
            self._no_duplicates = tuple("<{}>".format(x) for x in remove_duplicates)

    def _remove_duplicates(self, entries):
        """
        Remove duplicates from the entries.

        A 'duplicate' is an entry with the same `LABEL_PROP` property value.
        If `self._no_duplicates == True`, choose the subject to keep any which way.
        If `self._no_duplicates` is a tuple (or a list), choose the kept subject
        by comparing its type to the types contained in the tuple. The lower the
        index of the type in the tuple, the higher the priority.

        `entries` is the ARPA service results as a JSON object.
        """

        res = entries
        if self._no_duplicates == True:
            labels = set()
            add = labels.add
            res = [x for x in res if not (x[LABEL_PROP] in labels 
                # If the label is not in the labels set, add it to the set.
                # This works because set.add() returns None.
                or add(x[LABEL_PROP]))]

        elif self._no_duplicates:
            # self._no_duplicates is a tuple - prioritize types defined in it
            items = {}
            for x in res:
                x_label = x[LABEL_PROP].lower()
                # Get the types of the latest most preferrable entry that 
                # had the same label as this one
                prev_match_types = items.get(x_label, {}).get('properties', {}).get(TYPE_PROP, [])
                # Get matches from the preferred types for the previously selected entry
                prev_pref = set(prev_match_types).intersection(set(self._no_duplicates))
                try:
                    # Find the priority of the previously selected entry
                    prev_idx = min([self._no_duplicates.index(t) for t in prev_pref])
                except ValueError:
                    # No previous entry or previous entry doesn't have a preferred type
                    prev_idx = float('inf')
                # Get matches in the preferred types for this entry
                pref = set(x['properties'][TYPE_PROP]).intersection(self._no_duplicates)
                try:
                    idx = min([self._no_duplicates.index(t) for t in pref])
                except ValueError:
                    # This one is not of a preferred type
                    idx = float('inf')

                if (not prev_match_types) or idx < prev_idx:
                    # There is no previous entry with this label or
                    # the current match has a higher priority preferred type
                    items[x_label] = x

            res = [x for x in res if x in items.values()]

        return res

    def _filter(self, response):
        """
        Filter matches based on `self._ignore` and remove matches that are
        for ngrams with length less than `self.min_ngram_length`.

        Return the response with the ignored matches removed.

        `response` is the parsed ARPA service response.
        """

        res = response['results']

        # Filter ignored results
        if self._ignore:
            res = [x for x in res if x[LABEL_PROP].lower() not in self._ignore]

        # Filter by minimum ngram length
        if self._min_ngram_length > 1:
            res = [x for x in res if len(x['properties']['ngram'][0].split()) >= self._min_ngram_length]

        # Remove duplicates if requested
        res = self._remove_duplicates(res)

        response['results'] = res
        return response

    def _sanitize(self, text):
        # Remove quotation marks and brackets - ARPA can return an error if they're present
        return text.replace('"', '').replace("(", "").replace(")", "")

    def query(self, text):
        """
        Query the ARPA service and return the response as JSON

        `text` is the text used in the query.
        """

        text = self._sanitize(text)
        # Query the ARPA service with the text
        data = 'text="{}"'.format(text)
        res = requests.post(self._url, data={'text': text})
        try:
            res.raise_for_status()
        except HTTPError as e:
            raise HTTPError('Error ({}) when querying the ARPA service with data "{}".'.format(e.response.status_code, data))

        return self._filter(res.json())

    def get_uri_matches(self, text, validator=None):
        """
        Query ARPA and return a list of uris for resources that match the text.

        `text` is the text to use in the query.

        `validator` is a function that takes the ARPA results as parameter and returns
        validated results.
        """

        results = self.query(text)['results']

        if validator:
            results = validator(results)

        return [x['id'] for x in results]

class Bar:
    """
    Mock progress bar implementation
    """
    def __init__(self, n):
        self.n = n
    def update(self):
        pass

def get_bar(n, use_pyprind):
    """
    Get a progress bar.
    `n` is the number of iterations for the progress bar.
    If `use_pyprind` is true, try to return a pyprind.ProgBar instance. Otherwise,
    return a mock progress bar.
    """

    if use_pyprind:
        try:
            import pyprind
            return pyprind.ProgBar(n)
        except ImportError:
            pass

    return Bar(n)


def arpafy(graph, target_prop, arpa, source_prop=None, rdf_class=None, validator=None, progress=None):
    """
    Link a property to resources using ARPA. Modify the graph in place.

    Return a dict with the amount of processed triples (processed), 
    match count (matches) and errors encountered (errors).

    `graph` is the graph to link (will be modified).

    `target_prop` is the property name that is used for saving the link.

    `arpa` is the Arpa class instance.

    `source_prop` is the property that's value will be used when querying ARPA (if omitted, skos:prefLabel is used).

    If `rdf_class` is given, only go through instances of this type.

    `validator` is a function that takes a graph and a subject as parameter and returns a function
    that takes the original graph and the ARPA results as parameter and returns a subset of those results
    (that have been validated based on the subject, graph and results). Optional.
    This is a function and not an object because of reasons.

    If `progress` is True, show a progress bar. Requires pyprind.
    """

    if source_prop is None:
        source_prop = SKOS['prefLabel']

    subgraph = Graph()

    if rdf_class:
        # Filter out subjects that are not of the given type
        for s in graph.subjects(RDF.type, rdf_class):
            subgraph += graph.triples((s, source_prop, None))
    else:
        subgraph += graph.triples((None, source_prop, None))

    match_count = 0
    errors = []
    
    bar = get_bar(len(subgraph), progress)

    for s, o in subgraph.subject_objects():
        args = (o, validator(graph, s)) if validator else (o,)
        try:
            match_uris = arpa.get_uri_matches(*args)
        except (HTTPError, ValueError) as e:
            errors.append(e)
        else:
            match_count += len(match_uris)
            # Add each uri found as a value of the target property
            for uri in match_uris:
                graph.add((s, target_prop, URIRef(uri)))
        bar.update()

    return { 'processed': len(subgraph), 'matches': match_count, 'errors': errors }

def main():
    """Main function for running via the command line."""

    argparser = argparse.ArgumentParser(description="Link resources to an RDF graph with ARPA.",
            fromfile_prefix_chars="@")
    argparser.add_argument("input", help="Input rdf file")
    argparser.add_argument("output", help="Output file")
    argparser.add_argument("tprop", metavar="target_property", help="Target property for the matches")
    argparser.add_argument("arpa", help="ARPA service URL")
    argparser.add_argument("--fi", metavar="INPUT_FORMAT",
        help="Input file format (rdflib parser). Will be guessed if omitted.")
    argparser.add_argument("--fo", metavar="OUTPUT_FORMAT",
        help="Output file format (rdflib serializer). Default is turtle.", default="turtle")
    argparser.add_argument("--rdf_class", metavar="CLASS",
        help="Process only subjects of the given type (goes through all subjects by default).")
    argparser.add_argument("--prop", metavar="PROPERTY",
        help="Property that's value is to be used in matching. Default is skos:prefLabel.")
    argparser.add_argument("--ignore", nargs="*", metavar="TERM",
        help="Terms that should be ignored even if matched")
    argparser.add_argument("--min_ngram", default=1, metavar="N", type=int,
        help="The minimum ngram length that is considered a match. Default is 1.")
    argparser.add_argument("--no_duplicates", nargs="*", default=False, metavar="TYPE",
        help="""Remove duplicate matches based on the 'label' returned by the ARPA service.
        Here 'duplicate' means a subject with the same label as another subject in
        the same result set.
        A list of types can be given with this argument. If given, prioritize matches
        based on it - the first given type will get the highest priority and so on.
        Note that the response from the service has to include a 'type' variable
        for this to work.""")

    args = argparser.parse_args()

    if args.fi:
        input_format = args.fi
    else:
        input_format = guess_format(args.input)

    source_prop = None
    if args.prop:
        source_prop = URIRef(args.prop)

    rdf_class = None
    if args.rdf_class:
        rdf_class = URIRef(args.rdf_class)

    target_prop = URIRef(args.tprop)
    if args.no_duplicates == []:
        no_duplicates = True
    else:
        no_duplicates = args.no_duplicates

    # Parse the input rdf file
    g = Graph()
    g.parse(args.input, format=input_format)

    arpa = Arpa(args.arpa, no_duplicates, args.min_ngram, args.ignore)

    start_time = time.monotonic()

    # Query the ARPA service and add the matches
    res = arpafy(g, target_prop, arpa, source_prop, rdf_class, progress=True)

    end_time = time.monotonic()

    if res['errors']:
        print("Some errors occurred while querying:")
        for err in res['errors']:
            print(err)
    print("Processed {} triples, found {} matches ({} errors). Run time {}"
            .format(res['processed'], res['matches'], len(res['errors']), 
                timedelta(seconds=end_time-start_time)))

    # Serialize the graph to disk
    g.serialize(destination=args.output, format=args.fo)

if __name__ == '__main__':
    main()
</code></pre>
  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="arpa.LABEL_PROP" class="name">var <span class="ident">LABEL_PROP</span></p>
      
  
    <div class="desc"><p>The name of the property containing the label of the match in the ARPA results.</p></div>
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="arpa.TYPE_PROP" class="name">var <span class="ident">TYPE_PROP</span></p>
      
  
    <div class="desc"><p>The name of the property containing the type of the match in the ARPA results-&gt;properties.
Only needed for prioritized duplicate removal.</p></div>
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="arpa.arpafy">
    <p>def <span class="ident">arpafy</span>(</p><p>graph, target_prop, arpa, source_prop=None, rdf_class=None, validator=None, progress=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Link a property to resources using ARPA. Modify the graph in place.</p>
<p>Return a dict with the amount of processed triples (processed), 
match count (matches) and errors encountered (errors).</p>
<p><code>graph</code> is the graph to link (will be modified).</p>
<p><code>target_prop</code> is the property name that is used for saving the link.</p>
<p><code>arpa</code> is the Arpa class instance.</p>
<p><code>source_prop</code> is the property that's value will be used when querying ARPA (if omitted, skos:prefLabel is used).</p>
<p>If <code>rdf_class</code> is given, only go through instances of this type.</p>
<p><code>validator</code> is a function that takes a graph and a subject as parameter and returns a function
that takes the original graph and the ARPA results as parameter and returns a subset of those results
(that have been validated based on the subject, graph and results). Optional.
This is a function and not an object because of reasons.</p>
<p>If <code>progress</code> is True, show a progress bar. Requires pyprind.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-arpa.arpafy', this);">Show source &equiv;</a></p>
  <div id="source-arpa.arpafy" class="source">
    <pre><code>def arpafy(graph, target_prop, arpa, source_prop=None, rdf_class=None, validator=None, progress=None):
    """
    Link a property to resources using ARPA. Modify the graph in place.

    Return a dict with the amount of processed triples (processed), 
    match count (matches) and errors encountered (errors).

    `graph` is the graph to link (will be modified).

    `target_prop` is the property name that is used for saving the link.

    `arpa` is the Arpa class instance.

    `source_prop` is the property that's value will be used when querying ARPA (if omitted, skos:prefLabel is used).

    If `rdf_class` is given, only go through instances of this type.

    `validator` is a function that takes a graph and a subject as parameter and returns a function
    that takes the original graph and the ARPA results as parameter and returns a subset of those results
    (that have been validated based on the subject, graph and results). Optional.
    This is a function and not an object because of reasons.

    If `progress` is True, show a progress bar. Requires pyprind.
    """

    if source_prop is None:
        source_prop = SKOS['prefLabel']

    subgraph = Graph()

    if rdf_class:
        # Filter out subjects that are not of the given type
        for s in graph.subjects(RDF.type, rdf_class):
            subgraph += graph.triples((s, source_prop, None))
    else:
        subgraph += graph.triples((None, source_prop, None))

    match_count = 0
    errors = []
    
    bar = get_bar(len(subgraph), progress)

    for s, o in subgraph.subject_objects():
        args = (o, validator(graph, s)) if validator else (o,)
        try:
            match_uris = arpa.get_uri_matches(*args)
        except (HTTPError, ValueError) as e:
            errors.append(e)
        else:
            match_count += len(match_uris)
            # Add each uri found as a value of the target property
            for uri in match_uris:
                graph.add((s, target_prop, URIRef(uri)))
        bar.update()

    return { 'processed': len(subgraph), 'matches': match_count, 'errors': errors }
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="arpa.main">
    <p>def <span class="ident">main</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Main function for running via the command line.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-arpa.main', this);">Show source &equiv;</a></p>
  <div id="source-arpa.main" class="source">
    <pre><code>def main():
    """Main function for running via the command line."""

    argparser = argparse.ArgumentParser(description="Link resources to an RDF graph with ARPA.",
            fromfile_prefix_chars="@")
    argparser.add_argument("input", help="Input rdf file")
    argparser.add_argument("output", help="Output file")
    argparser.add_argument("tprop", metavar="target_property", help="Target property for the matches")
    argparser.add_argument("arpa", help="ARPA service URL")
    argparser.add_argument("--fi", metavar="INPUT_FORMAT",
        help="Input file format (rdflib parser). Will be guessed if omitted.")
    argparser.add_argument("--fo", metavar="OUTPUT_FORMAT",
        help="Output file format (rdflib serializer). Default is turtle.", default="turtle")
    argparser.add_argument("--rdf_class", metavar="CLASS",
        help="Process only subjects of the given type (goes through all subjects by default).")
    argparser.add_argument("--prop", metavar="PROPERTY",
        help="Property that's value is to be used in matching. Default is skos:prefLabel.")
    argparser.add_argument("--ignore", nargs="*", metavar="TERM",
        help="Terms that should be ignored even if matched")
    argparser.add_argument("--min_ngram", default=1, metavar="N", type=int,
        help="The minimum ngram length that is considered a match. Default is 1.")
    argparser.add_argument("--no_duplicates", nargs="*", default=False, metavar="TYPE",
        help="""Remove duplicate matches based on the 'label' returned by the ARPA service.
        Here 'duplicate' means a subject with the same label as another subject in
        the same result set.
        A list of types can be given with this argument. If given, prioritize matches
        based on it - the first given type will get the highest priority and so on.
        Note that the response from the service has to include a 'type' variable
        for this to work.""")

    args = argparser.parse_args()

    if args.fi:
        input_format = args.fi
    else:
        input_format = guess_format(args.input)

    source_prop = None
    if args.prop:
        source_prop = URIRef(args.prop)

    rdf_class = None
    if args.rdf_class:
        rdf_class = URIRef(args.rdf_class)

    target_prop = URIRef(args.tprop)
    if args.no_duplicates == []:
        no_duplicates = True
    else:
        no_duplicates = args.no_duplicates

    # Parse the input rdf file
    g = Graph()
    g.parse(args.input, format=input_format)

    arpa = Arpa(args.arpa, no_duplicates, args.min_ngram, args.ignore)

    start_time = time.monotonic()

    # Query the ARPA service and add the matches
    res = arpafy(g, target_prop, arpa, source_prop, rdf_class, progress=True)

    end_time = time.monotonic()

    if res['errors']:
        print("Some errors occurred while querying:")
        for err in res['errors']:
            print(err)
    print("Processed {} triples, found {} matches ({} errors). Run time {}"
            .format(res['processed'], res['matches'], len(res['errors']), 
                timedelta(seconds=end_time-start_time)))

    # Serialize the graph to disk
    g.serialize(destination=args.output, format=args.fo)
</code></pre>
  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="arpa.Arpa" class="name">class <span class="ident">Arpa</span></p>
      
  
    <div class="desc"><p>Class representing the ARPA service</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-arpa.Arpa', this);">Show source &equiv;</a></p>
  <div id="source-arpa.Arpa" class="source">
    <pre><code>class Arpa:
    """Class representing the ARPA service"""

    def __init__(self, url, remove_duplicates=False, min_ngram_length=1, ignore=None):
        """
        Initialize the Arpa service object.

        `url` is the ARPA service url.

        If `remove_duplicates` is `True`, choose only one subject out of all the
        matched subjects that have the same label (arbitrarily).
        If, instead, the value is a list or a tuple, assume that it represents
        a list of class names and prefer those classes when choosing
        the subject. The ARPA results must include a property (`TYPE_PROP`)
        that has the class of the match as the value.

        `min_ngram_length` is the minimum ngram match length that will be included when
        returning the query results.

        `ignore` is a list of matches that should be removed from the results (case insensitive).
        """

        self._url = url
        self._ignore = [s.lower() for s in ignore or []]
        self._min_ngram_length = min_ngram_length

        if type(remove_duplicates) == bool:
            self._no_duplicates = remove_duplicates
        else:
            self._no_duplicates = tuple("<{}>".format(x) for x in remove_duplicates)

    def _remove_duplicates(self, entries):
        """
        Remove duplicates from the entries.

        A 'duplicate' is an entry with the same `LABEL_PROP` property value.
        If `self._no_duplicates == True`, choose the subject to keep any which way.
        If `self._no_duplicates` is a tuple (or a list), choose the kept subject
        by comparing its type to the types contained in the tuple. The lower the
        index of the type in the tuple, the higher the priority.

        `entries` is the ARPA service results as a JSON object.
        """

        res = entries
        if self._no_duplicates == True:
            labels = set()
            add = labels.add
            res = [x for x in res if not (x[LABEL_PROP] in labels 
                # If the label is not in the labels set, add it to the set.
                # This works because set.add() returns None.
                or add(x[LABEL_PROP]))]

        elif self._no_duplicates:
            # self._no_duplicates is a tuple - prioritize types defined in it
            items = {}
            for x in res:
                x_label = x[LABEL_PROP].lower()
                # Get the types of the latest most preferrable entry that 
                # had the same label as this one
                prev_match_types = items.get(x_label, {}).get('properties', {}).get(TYPE_PROP, [])
                # Get matches from the preferred types for the previously selected entry
                prev_pref = set(prev_match_types).intersection(set(self._no_duplicates))
                try:
                    # Find the priority of the previously selected entry
                    prev_idx = min([self._no_duplicates.index(t) for t in prev_pref])
                except ValueError:
                    # No previous entry or previous entry doesn't have a preferred type
                    prev_idx = float('inf')
                # Get matches in the preferred types for this entry
                pref = set(x['properties'][TYPE_PROP]).intersection(self._no_duplicates)
                try:
                    idx = min([self._no_duplicates.index(t) for t in pref])
                except ValueError:
                    # This one is not of a preferred type
                    idx = float('inf')

                if (not prev_match_types) or idx < prev_idx:
                    # There is no previous entry with this label or
                    # the current match has a higher priority preferred type
                    items[x_label] = x

            res = [x for x in res if x in items.values()]

        return res

    def _filter(self, response):
        """
        Filter matches based on `self._ignore` and remove matches that are
        for ngrams with length less than `self.min_ngram_length`.

        Return the response with the ignored matches removed.

        `response` is the parsed ARPA service response.
        """

        res = response['results']

        # Filter ignored results
        if self._ignore:
            res = [x for x in res if x[LABEL_PROP].lower() not in self._ignore]

        # Filter by minimum ngram length
        if self._min_ngram_length > 1:
            res = [x for x in res if len(x['properties']['ngram'][0].split()) >= self._min_ngram_length]

        # Remove duplicates if requested
        res = self._remove_duplicates(res)

        response['results'] = res
        return response

    def _sanitize(self, text):
        # Remove quotation marks and brackets - ARPA can return an error if they're present
        return text.replace('"', '').replace("(", "").replace(")", "")

    def query(self, text):
        """
        Query the ARPA service and return the response as JSON

        `text` is the text used in the query.
        """

        text = self._sanitize(text)
        # Query the ARPA service with the text
        data = 'text="{}"'.format(text)
        res = requests.post(self._url, data={'text': text})
        try:
            res.raise_for_status()
        except HTTPError as e:
            raise HTTPError('Error ({}) when querying the ARPA service with data "{}".'.format(e.response.status_code, data))

        return self._filter(res.json())

    def get_uri_matches(self, text, validator=None):
        """
        Query ARPA and return a list of uris for resources that match the text.

        `text` is the text to use in the query.

        `validator` is a function that takes the ARPA results as parameter and returns
        validated results.
        """

        results = self.query(text)['results']

        if validator:
            results = validator(results)

        return [x['id'] for x in results]
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#arpa.Arpa">Arpa</a></li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="arpa.Arpa.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, url, remove_duplicates=False, min_ngram_length=1, ignore=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the Arpa service object.</p>
<p><code>url</code> is the ARPA service url.</p>
<p>If <code>remove_duplicates</code> is <code>True</code>, choose only one subject out of all the
matched subjects that have the same label (arbitrarily).
If, instead, the value is a list or a tuple, assume that it represents
a list of class names and prefer those classes when choosing
the subject. The ARPA results must include a property (<code>TYPE_PROP</code>)
that has the class of the match as the value.</p>
<p><code>min_ngram_length</code> is the minimum ngram match length that will be included when
returning the query results.</p>
<p><code>ignore</code> is a list of matches that should be removed from the results (case insensitive).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-arpa.Arpa.__init__', this);">Show source &equiv;</a></p>
  <div id="source-arpa.Arpa.__init__" class="source">
    <pre><code>def __init__(self, url, remove_duplicates=False, min_ngram_length=1, ignore=None):
    """
    Initialize the Arpa service object.
    `url` is the ARPA service url.
    If `remove_duplicates` is `True`, choose only one subject out of all the
    matched subjects that have the same label (arbitrarily).
    If, instead, the value is a list or a tuple, assume that it represents
    a list of class names and prefer those classes when choosing
    the subject. The ARPA results must include a property (`TYPE_PROP`)
    that has the class of the match as the value.
    `min_ngram_length` is the minimum ngram match length that will be included when
    returning the query results.
    `ignore` is a list of matches that should be removed from the results (case insensitive).
    """
    self._url = url
    self._ignore = [s.lower() for s in ignore or []]
    self._min_ngram_length = min_ngram_length
    if type(remove_duplicates) == bool:
        self._no_duplicates = remove_duplicates
    else:
        self._no_duplicates = tuple("<{}>".format(x) for x in remove_duplicates)
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="arpa.Arpa.get_uri_matches">
    <p>def <span class="ident">get_uri_matches</span>(</p><p>self, text, validator=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Query ARPA and return a list of uris for resources that match the text.</p>
<p><code>text</code> is the text to use in the query.</p>
<p><code>validator</code> is a function that takes the ARPA results as parameter and returns
validated results.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-arpa.Arpa.get_uri_matches', this);">Show source &equiv;</a></p>
  <div id="source-arpa.Arpa.get_uri_matches" class="source">
    <pre><code>def get_uri_matches(self, text, validator=None):
    """
    Query ARPA and return a list of uris for resources that match the text.
    `text` is the text to use in the query.
    `validator` is a function that takes the ARPA results as parameter and returns
    validated results.
    """
    results = self.query(text)['results']
    if validator:
        results = validator(results)
    return [x['id'] for x in results]
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="arpa.Arpa.query">
    <p>def <span class="ident">query</span>(</p><p>self, text)</p>
    </div>
    

    
  
    <div class="desc"><p>Query the ARPA service and return the response as JSON</p>
<p><code>text</code> is the text used in the query.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-arpa.Arpa.query', this);">Show source &equiv;</a></p>
  <div id="source-arpa.Arpa.query" class="source">
    <pre><code>def query(self, text):
    """
    Query the ARPA service and return the response as JSON
    `text` is the text used in the query.
    """
    text = self._sanitize(text)
    # Query the ARPA service with the text
    data = 'text="{}"'.format(text)
    res = requests.post(self._url, data={'text': text})
    try:
        res.raise_for_status()
    except HTTPError as e:
        raise HTTPError('Error ({}) when querying the ARPA service with data "{}".'.format(e.response.status_code, data))
    return self._filter(res.json())
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
